import { Component, Vue } from 'vue-property-decorator';
import axios from 'axios';

@Component
export default class Sessions extends Vue {
  public success: string = null;
  public error: string = null;
  public sessions: any[] = [];

  public created(): void {
    this.retrieveSessions();
  }

  public retrieveSessions(): void {
    <%_ if (authenticationType === 'uaa') { _%>
    axios.get('services/uaa/api/account/sessions/').then(response => {
    <%_ } else { _%>
    axios.get('api/account/sessions/').then(response => {
    <%_ } _%>
      this.error = null;
      this.sessions = response.data;
    });
  }

  public invalidate(session): void {
    axios
      <%_ if (authenticationType === 'uaa') { _%>
      .delete('services/uaa/api/account/sessions/' + session)
      <%_ } else { _%>
      .delete('api/account/sessions/' + session)
      <%_ } _%>
      .then(() => {
        this.error = null;
        this.success = 'OK';
        this.retrieveSessions();
      })
    .catch(() => {
      this.success = null;
      this.error = 'ERROR';
    });
  }

  public get authenticated(): boolean {
    return this.$store.getters.authenticated;
  }

  public get username(): string {
    return this.$store.getters.account ? this.$store.getters.account.login : '';
  }
}
