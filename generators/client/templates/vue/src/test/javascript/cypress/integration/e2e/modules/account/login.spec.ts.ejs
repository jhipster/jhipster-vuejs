import SignInPage, {
  loginPageSelector,
  registerFormSelector,
  loginTitleSelector,
  usernameSelector,
  passwordSelector,
  submitSelector,
  loginAlertSelector }
from '../../page-objects/signin-page';
import NavBarPage, {
  headerSelector,
  headerTabsSelector,
  navbarSelector,
  adminMenuSelector,
  accountMenuSelector,
  loginSelector,
  logoutSelector,
  entityMenuSelector,
  registerSelector
}
from '../../page-objects/navbar-page';

describe('Log In', () => {
  const loginPageTitle = 'login-title';

  beforeEach(() => {
    cy.logout();
    cy.visit('/');
    NavBarPage.getSignInPage();
  });

  it('should display login modal', () => {
    cy.get(loginPageSelector).find(loginTitleSelector);
    cy.get(loginPageSelector).find(usernameSelector);
    cy.get(loginPageSelector).find(passwordSelector);
    cy.get(loginPageSelector).find(submitSelector);

    // TODO: test checkbox and alert warnings si moins de flemme
  });

  it('should fail to login with bad password', () => {
<%_ if (authenticationType !== 'oauth2') { _%>
    SignInPage.autoSignInUsing('admin', 'wrong');
    cy.get(loginPageSelector)
      .find(loginTitleSelector)
      .should('exist');
    cy.get(loginPageSelector)
      .find(loginAlertSelector)
      .should('have.class', 'alert-danger');
<%_ } else {_%>
    SignInPage.loginWithOAuth('admin', 'wrong');
    cy.get('.alert-error').then($alert => {
      if ($alert.length) {
        // Keycloak
        expect($alert.get(0).innerText).to.equal('Invalid username or password.');
      } else {
        // Okta
        cy.get('.infobox-error').invoke('text').should('equal', 'Sign in failed!');
      }
    });
<%_ } _%>
  });

  it('should login with admin account', () => {
<%_ if (authenticationType !== 'oauth2') { _%>
    SignInPage.autoSignInUsing('admin', 'admin');
    cy.get(loginPageSelector)
      .find(loginTitleSelector)
      .should('not.exist');
<%_ } else {_%>
    SignInPage.loginWithOAuth('admin', 'admin');
    cy.get('.alert-success').should('exist');
<%_ } _%>
  });
});
